- name: develop
  type: serial
  tag: develop
  steps:
  - name: integration
    type: parallel
    steps:
    - name: lint
      service: frontend-dev
      command: sh .codeship/linters.sh
    - name: sast
      service: njsscan-dev
      command: -w /usr/src/app
    - name: build
      service: frontend-dev
      command: sh .codeship/artifact.sh
  - name: deployment
    service: awsdeployment-dev
    command: sh ./usr/src/app/.codeship/deploy.sh

- name: staging
  type: serial
  tag: staging
  steps:
  - name: integration
    type: parallel
    steps:
    - name: lint
      service: frontend-stage
      command: sh .codeship/linters.sh
    - name: build
      service: frontend-stage
      command: sh .codeship/artifact.sh
  - name: deployment
    service: awsdeployment-stage
    command: sh ./usr/src/app/.codeship/deploy.sh

- name: production
  type: serial
  tag: '^(master|main)$'
  steps:
  - name: integration
    type: parallel
    steps:
    - name: lint
      service: frontend-prod
      command: sh .codeship/linters.sh
    - name: build
      service: frontend-prod
      command: sh .codeship/artifact.sh
  - name: deployment
    service: awsdeployment-prod
    command: sh ./usr/src/app/.codeship/deploy.sh
